#18
=
18번 문제로 들어가보면 SQL Injection이라는 문구와 함께 어떤 값을 입력할 수 있는 박스가 있다.
![](https://postfiles.pstatic.net/MjAxOTExMjJfNjAg/MDAxNTc0NDAwNDYxNzI2.1NoglP-2gffpGUFh3mVT_hb9V3D-4bY6qXOEk1vupNEg.hCvDE5miD36QjkkjsyMqflljZHHmKx4sdFZEJ_7Iz0wg.JPEG.rlaeoghks823/K-007.jpg?type=w773)

`view-source`를 통해 페이지 소스를 확인해 보았다.

```
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 18</title>
<style type="text/css">
body { background:black; color:white; font-size:10pt; }
input { background:silver; }
a { color:lightgreen; }
</style>
</head>
<body>
<br><br>
<center><h1>SQL INJECTION</h1>
<form method=get action=index.php>
<table border=0 align=center cellpadding=10 cellspacing=0>
<tr><td><input type=text name=no></td><td><input type=submit></td></tr>
</table>
</form>
<a style=background:gray;color:black;width:100;font-size:9pt;><b>RESULT</b><br>
<?php
if($_GET['no']){
  $db = dbconnect();
  if(preg_match("/ |\/|\(|\)|\||&|select|from|0x/i",$_GET['no'])) exit("no hack");
  $result = mysqli_fetch_array(mysqli_query($db,"select id from chall18 where id='guest' and no=$_GET[no]")); // admin's no = 2

  if($result['id']=="guest") echo "hi guest";
  if($result['id']=="admin"){
    solve(18);
    echo "hi admin!";
  }
}
?>
</a>
<br><br><a href=?view_source=1>view-source</a>
</center>
</body>
</html>
```

`mysqli_fetch_array`를 통해 `chall18`이라는 테이블에서 값을 가져와 result에 저장한다는 것을 확인 할 수 있다.   
또한 result값이 `guest`이면 "hi guest"를 출력하고 'admin'이면 "hi admin"을 출력함과 동시에 문제가 해결되는것으로 보인다.

박스에 1을 입력했을 때 "hi guest"가 출력되는 것으로 보아 `guest`의 `no` 값은 1이다.

또한 힌트로 admin은 2라고 알려주고 있으므로 

no = 2가 되면 문제를 해결 할 수 있을 것이다.

그러나 그냥 박스에 2를 넣으면 아무런 반응이 일어나지 않는다.

그 이유는 바로 'id'와 'no'가 `and`로 연결되어있기 때문인데 'id'가 guest인데 'no'가 2면 and 연산에 의해   
`id='guest' and no=$_GET[no]`  
이것은 거짓으로 처리가 된다.  

이를 해결해 주기 위해 'or'를 이용하면 되는데  
앞의 `and` 연산자를 거짓으로 만들고 뒤에 `or`를 통해 값을 넣어주면 `or` 값이 참값이된다. (우선순위는 and > or 이다.)

하지만 박스에 -1 or no=2를 넣어주면 `preg_match`로 공백을 거르기 때문에 문제 해결이 안된다.

## * 공백 우회가 가능한 문자의 종류

1. Tab : %09

2. Line Feed (\n): %0a

3. Carrage Return(wr) : %0d

4. 주석 : /**/

5. 괄호 : ()

6. 더하기 : +

위에 나온 공백 우회가 가능한 문자의 종류를 이용하여 박스에 값을 넣어주면  
ex) 111%0aor%0ano=2
해결이 된다.

하지만 문제가 또 발생한다.

![](https://postfiles.pstatic.net/MjAxOTExMjJfNSAg/MDAxNTc0NDAxNzE2Nzcz.Dm2sxfz6wQpRrdk4vfPN4RdyDA5czIrklihCL5J0e6Yg.H36tZX9R-ScywhBwNXES_dRPEKMz4MJV6llXNd8d5dQg.JPEG.rlaeoghks823/K-008.jpg?type=w773)

url을 살펴보면 박스에 `111%0aor%0ano=2` 값을 넣으면 사진 처럼 url이 인코딩되어버린다.

18번 문제는 get방식을 이용하므로  
박스에 값을 넣는 것이 아니라 url창에 값을 넣어준다면 해결 할 수 있다.


## 참고
mysqli_fetch_array 함수는 mysqli_query 를 통해 얻은 리절트 셋(result set)에서 레코드를 1개씩 리턴해주는 함수입니다.

레코드를 1개씩 리턴해주는 것은 mysqli_fetch_row 나 mysqli_fetch_assoc 와 동일하지만 리턴하는 배열의 형태가 틀립니다.

mysqli_fetch_array 함수는 순번을 키로 하는 일반 배열과 컬럼명을 키로 하는 연관배열 둘 모두 값으로 갖는 배열을 리턴합니다.

