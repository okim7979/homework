#41
==

37번 문제처럼 이번 문제도 파일을 올림으로써 문제를 해결해야하는 것으로 보인다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfMTY3/MDAxNTc5MzQ2ODI3MzM3.v0CSHdwrGWRuQWo3upNnyaYsBFocSL0sp6dq0dRLZ78g.9m9M_5GbV_GpMRIV3oZ2Js9Ris1nTS7kTh5mtz6NNqwg.JPEG.rlaeoghks823/K-060.jpg?type=w773)

먼저 소스 코드를 살펴보자.

```
<?php
  include "../../config.php";
  include "./inc.php";
  if($_GET['view_source']) view_source();
  error_reporting(E_ALL);
  ini_set("display_errors", 1);
?><html>
<head>
<title>Challenge 41</title>
</head>
<body>
<?php
  if(isset($_FILES['up']) && $_FILES['up']){
    $fn = $_FILES['up']['name'];
    $fn = str_replace(".","",$fn);
    $fn = str_replace("<","",$fn);
    $fn = str_replace(">","",$fn);
    $fn = str_replace("/","",$fn);

    $cp = $_FILES['up']['tmp_name'];
    copy($cp,"./{$upload_dir}/{$fn}");
    $f = @fopen("./{$upload_dir}/{$fn}","w");
    @fwrite($f,$flag);
    @fclose($f);
    echo("Done~");
  }
?>
<form method=post enctype="multipart/form-data">
<input type=file name=up><input type=submit value='upload'>
</form>
<a href=./?view_source=1>view-source</a>
</body>
</html>
```

소스 코드를 살펴보는 도중 에러 발생시 출력해주는 소스가 있다는 것을 발견했다

```
 error_reporting(E_ALL);
  ini_set("display_errors", 1);
```

이 에러 발생시 나오는 문구는 아래 사진처럼 출력된다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfMjA1/MDAxNTc5MzQ2Nzc3MDIw.hBnIQItoRiiBrXYm-r0ws_xY2WuVKPKKp-7jFARsHzcg.BtQ_qEXMN81ZFRkfKU-pUpf-s74MkO2ERjZEHE7ia6og.JPEG.rlaeoghks823/K-057.jpg?type=w773)

아무런 파일을 올리지 않고 upload시 오류 문구가 뜨는 것을 볼 수 있다.

그러면 파일을 올릴 때 오류를 발생시키면 코드에서 가려져있는 파일 위치를 알 수 있을 것이다.

파일을 업로드 할 때 파일 이름의 길이는 255자 정도로 제한이 되어있다.

만약 이 이름을 255자 보다 더 길게해서 올리게 된다면 에러 코드가 출력될 것이다.

그래서 다음과 같이 a가 400개 정도되는 이름의 파일을 업로드 해보니 숨겨진 파일의 위치를 찾을 수 있었다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfNCAg/MDAxNTc5MzQ2Nzg0Nzc4.0sIMnRaV4pXu42RLa19euIIRxDM49PlV6NqEwS7Uvwcg.kL6pHvD8KU7g8kw62WWRdXB2QtPvTOZ7ztWnqmqUxSwg.JPEG.rlaeoghks823/K-058.jpg?type=w773)

그다음 정상적인 방법으로 hi라는 파일을 업로드 시킨 후 정확한 파일 위치로 hi를 열어주니 flag 값이 나왔다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfMTQ4/MDAxNTc5MzQ2NzkxMjcw.yIDRsyiPym0MSLR-ngjjABFo8gQi5ALka9_I7ZeYXlQg.1Ia3r5bQ5a9bZgptcR4VNWyJo0-sUllcV-zYLmpg8N0g.JPEG.rlaeoghks823/K-059.jpg?type=w773)
