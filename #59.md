#59
===

문제를 확인해보면 join과 login에 id 값과 phone 값을 입력할 수 있는 칸이 보인다.

![](https://postfiles.pstatic.net/MjAyMDAxMDVfNzcg/MDAxNTc4MjE2NjQ3NTA2.QFXHjWkXIF3Nsg85JFL5yoryzgWAg14g3WmBpeQp1H4g.oUeH1PkRcU9B29VOG36_SzSvLTZlna19F8e48DLB71Qg.JPEG.rlaeoghks823/K-050.jpg?type=w773)

먼저 소스를 살펴보자.

```
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
  $db = dbconnect();
  if($_POST['lid'] && isset($_POST['lphone'])){
    $_POST['lid'] = addslashes($_POST['lid']);
    $_POST['lphone'] = addslashes($_POST['lphone']);
    $result = mysqli_fetch_array(mysqli_query($db,"select id,lv from chall59 where id='{$_POST['lid']}' and phone='{$_POST['lphone']}'"));
    if($result['id']){
      echo "id : {$result['id']}<br>lv : {$result['lv']}<br><br>";
      if($result['lv'] == "admin"){
      mysqli_query($db,"delete from chall59");
      solve(59);
    }
    echo "<br><a href=./?view_source=1>view-source</a>";
    exit();
    }
  }
  if($_POST['id'] && isset($_POST['phone'])){
    $_POST['id'] = addslashes($_POST['id']);
    $_POST['phone'] = addslashes($_POST['phone']);
    if(strlen($_POST['phone'])>=20) exit("Access Denied");
    if(preg_match("/admin/i",$_POST['id'])) exit("Access Denied");
    if(preg_match("/admin|0x|#|hex|char|ascii|ord|select/i",$_POST['phone'])) exit("Access Denied");
    mysqli_query($db,"insert into chall59 values('{$_POST['id']}',{$_POST['phone']},'guest')");
  }
?>
```

join에 id와 phone값을 입력해서 제출하고 login에 입력시 mysqli 구문을 통해 테이블에서 id 값과 lv 값을 불러와 출력해 주는 것을 알 수 있다.

![](https://postfiles.pstatic.net/MjAyMDAxMDVfODMg/MDAxNTc4MjE2NjUwMjk0.ko6VSRznPc56vFVtar77qE2QHsFllHprwvjTht_J78Mg.ihyo4ghM3S2xqzGJ_G7RsfxtE0uG42XfkD6lGW6CcnEg.JPEG.rlaeoghks823/K-051.jpg?type=w773)

만약 lv 값이 admin이면 문제가 풀린다는 것 또한 알 수 있다.

그러나 join 값에서 id값이나 phone 값에 admin이 입력되면 걸러진다.

이를 우회하기 위해 reverse 함수를 사용하였다.

`mysqli_query($db,"insert into chall59 values('{$_POST['id']}',{$_POST['phone']},'guest')");`  

이 소스 부분이 다음과같이 수정되면 lv값에 admin이 입력될 것이다.

`insert into chall59 values ('nimda', 1, reverse(id))`

![](https://postfiles.pstatic.net/MjAyMDAxMDVfODYg/MDAxNTc4MjE2NjUzNDA5.SuPYYuYun7vZPBV1jEB1CkBX8mtttIO5L7vHai-Bq8cg.TYpysE15fgveoQ_rd_B2FfLy-vyqxslO5gT-m_cEoHYg.JPEG.rlaeoghks823/K-052.jpg?type=w773)

## 참고

### isset
* isset으로 변수가 설정되었는지 확인할 수 있습니다.

### addslashes()

어떤 문자열을 데이타베이스의 필드값으로 저장하기 전에 사용되는 함수로  
만일, 그 문자열에 특수 문자, 예를 들어 작은 따옴표('), 쌍 따옴표("), 역슬래시(\) 문자가 포함되어 있다면   
그러한 문자앞에 역슬래시(\)를 붙이는 역할을 합니다.

 ### reverse 
 * 인자로 들어온 값을 거꾸로 출력한다.
