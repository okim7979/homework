#7
===

문제에 접속을 해주면 다음과 같은 화면이 나온다.

![](https://postfiles.pstatic.net/MjAyMDAxMTlfNTAg/MDAxNTc5NDIwMTc3NDA4.8x_tMenMR3Np_ekY1RpVB8tfQC6PSYsFCzCCeifUyqsg.6VDKUBhRm7a4QIyt0rn6TmjxY-7mecq5sPRqGxvWDBUg.JPEG.rlaeoghks823/K-085.jpg?type=w773)

바로 `auth`라는 버튼을 눌러보았지만 `access_denied`라는 알림창만 나온다.

![](https://postfiles.pstatic.net/MjAyMDAxMTlfMTQ4/MDAxNTc5NDIwMTc5NDEw.OQdy-rf9dI0c-gCBHsfl3OrZG9hO1LCvS19zl_2kiQQg.OKDz04eghZytlq1VSkbVjn9n_1zfJ3H4X-GNmpQO-J4g.JPEG.rlaeoghks823/K-086.jpg?type=w773)

소스 보기를 통해 소스 코드를 살펴보았다.

```php
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 7</title>
</head>
<body>
<?php
$go=$_GET['val'];
if(!$go) { echo("<meta http-equiv=refresh content=0;url=index.php?val=1>"); }
echo("<html><head><title>admin page</title></head><body bgcolor='black'><font size=2 color=gray><b><h3>Admin page</h3></b><p>");
if(preg_match("/2|-|\+|from|_|=|\\s|\*|\//i",$go)) exit("Access Denied!");
$db = dbconnect();
$rand=rand(1,5);
if($rand==1){
  $result=mysqli_query($db,"select lv from chall7 where lv=($go)") or die("nice try!");
}
if($rand==2){
  $result=mysqli_query($db,"select lv from chall7 where lv=(($go))") or die("nice try!");
}
if($rand==3){
  $result=mysqli_query($db,"select lv from chall7 where lv=((($go)))") or die("nice try!");
}
if($rand==4){
  $result=mysqli_query($db,"select lv from chall7 where lv=(((($go))))") or die("nice try!");
}
if($rand==5){
  $result=mysqli_query($db,"select lv from chall7 where lv=((((($go)))))") or die("nice try!");
}
$data=mysqli_fetch_array($result);
if(!$data[0]) { echo("query error"); exit(); }
if($data[0]==1){
  echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Access_Denied!')\"><p>");
}
elseif($data[0]==2){
  echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Hello admin')\"><p>");
  solve(7);
}
?>
<a href=./?view_source=1>view-source</a>
</body>
</html>
```

`get`으로 `val`값을 `go`에 저장을 해주고 이것을 `mysqli_query`을 통해 나온 값을 `$result`에 넣어주는 것으로 보인다.

그리고 이 `$result`값을 배열로 변환하여 `data`에 저장해주고  

이 값이 없으면 query error  
이 값이 1이면 Access_Denied!  
이 값이 2이면 Hello admin과 함께 문제가 해결된다.

하지만 우리는 chall7 테이블의 lv에 어떤 값이 들어있는지 알지 못한다.

이를 해결해주기 위해 직접 2라는 값을 넣어주어야 하며 이를 위한 함수로 UNION을 이용한다.

그러나 `preg_match`로 2라는 값과 모든 공백들이 걸러내진다.

2를 우회하기 위해 반올림 함수인 `round`를 이용해주었고  
공백을 우회해주기 위해 `( , )` 이것을 이용해주었다.

따라서 `val` 값에 `0)UNION(SELECT(ROUND(1.5)))%23`를 넣어주고 `rand`값이 1이 나올때 까지 새로고침을 눌러주었다.

이러한 방법으로 문제가 해결되었다.
